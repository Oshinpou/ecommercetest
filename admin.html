<!-- admin.html --><!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Bobomacx</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.2.1/dist/pouchdb.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f9fa; }
    input { margin-bottom: 10px; width: 300px; padding: 8px; }
    button { margin: 5px; padding: 8px 12px; }
    .account { background: #fff; padding: 10px; border-radius: 5px; margin: 10px 0; box-shadow: 0 0 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h2>Bobomacx Admin Panel</h2>
  <input type="text" id="searchUsername" placeholder="Search by Username" />
  <input type="email" id="searchEmail" placeholder="Search by Email" />
  <input type="tel" id="searchPhone" placeholder="Search by Phone (with country code)" />
  <button onclick="searchAccounts()">Search</button>  <div id="accountsContainer"></div>  <script>
    const gun = Gun();
    const db = new PouchDB('bobomacx');

    function loadAllAccounts() {
      gun.get('bobomacx').get('accounts').map().once((data, key) => {
        if (data) displayAccount(key, data);
      });
    }

    function displayAccount(username, data) {
      const container = document.getElementById('accountsContainer');
      const div = document.createElement('div');
      div.className = 'account';
      div.id = `acc-${username}`;
      div.innerHTML = `
        <b>Username:</b> ${username}<br>
        <b>Email:</b> ${data.email}<br>
        <b>Phone:</b> ${data.phone}<br>
        <b>Created At (IST):</b> ${data.createdAt || 'Unknown'}<br>
        <b>Status:</b> <span id="status-${username}">${data.status || 'active'}</span><br>
        <button onclick="deactivate('${username}')">Deactivate</button>
        <button onclick="reactivate('${username}')">Reactivate</button>
        <button onclick="confirmDelete('${username}')">Delete Permanently</button>
      `;
      container.appendChild(div);
    }

    function deactivate(username) {
      gun.get('bobomacx').get('accounts').get(username).get('status').put('deactivated');
      document.getElementById(`status-${username}`).innerText = 'deactivated';
    }

    function reactivate(username) {
      gun.get('bobomacx').get('accounts').get(username).get('status').put('active');
      document.getElementById(`status-${username}`).innerText = 'active';
    }

    function confirmDelete(username) {
      let confirmed = 0;
      const interval = setInterval(() => {
        if (confirm(`Confirm ${++confirmed}/12 to delete account: ${username}?`)) {
          if (confirmed === 12) {
            deleteAccount(username);
            clearInterval(interval);
          }
        } else {
          clearInterval(interval);
          alert('Deletion cancelled');
        }
      }, 200);
    }

    function deleteAccount(username) {
      gun.get('bobomacx').get('accounts').get(username).put(null);
      db.get(username).then(doc => db.remove(doc));
      const elem = document.getElementById(`acc-${username}`);
      if (elem) elem.remove();
      alert('Account permanently deleted.');
    }

    function searchAccounts() {
      const user = searchUsername.value.trim().toLowerCase();
      const email = searchEmail.value.trim().toLowerCase();
      const phone = searchPhone.value.trim();
      document.getElementById('accountsContainer').innerHTML = '';
      gun.get('bobomacx').get('accounts').map().once((data, key) => {
        if (!data) return;
        if (
          (user && key.toLowerCase().includes(user)) ||
          (email && data.email?.toLowerCase().includes(email)) ||
          (phone && data.phone?.includes(phone))
        ) displayAccount(key, data);
      });
    }

    loadAllAccounts();
  </script></body>
</html>
