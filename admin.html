<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bobomacx Admin Panel</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pouchdb/dist/pouchdb.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body class="p-4">
  <h1 class="mb-4">Bobomacx Admin Panel</h1>  <div class="mb-5">
    <h3>Accounts Created</h3>
    <table class="table table-bordered" id="accountsTable">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Country Code</th>
          <th>Created Date & Time (India)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="accountList"></tbody>
    </table>
  </div>  <script>
    const gun = Gun(['https://gunjs-server.herokuapp.com/gun']);
    const db = new PouchDB('bobomacx_accounts');
    const adminRef = gun.get('bobomacx').get('accounts');

    // Load accounts
    adminRef.map().once((data, key) => {
      if (data && data.username) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${data.username}</td>
          <td>${data.email}</td>
          <td>${data.phone}</td>
          <td>${data.countryCode}</td>
          <td>${data.createdAt}</td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="confirmDelete('${key}')">Delete Permanently</button>
          </td>
        `;
        document.getElementById('accountList').appendChild(tr);
      }
    });

    function confirmDelete(key) {
      let confirmCount = 0;
      const requiredConfirms = 12;
      const confirmDelete = () => {
        confirmCount++;
        if (confirmCount === requiredConfirms) {
          deleteAllAccountData(key);
        } else {
          const remaining = requiredConfirms - confirmCount;
          alert(`Confirm ${remaining} more time(s) to delete.`);
        }
      };
      confirmDelete();
    }

    function deleteAllAccountData(key) {
      // 1. Clear from Gun
      gun.get('bobomacx').get('accounts').get(key).put(null);

      // 2. Clear from PouchDB
      db.get(key).then(doc => {
        return db.remove(doc);
      }).catch(err => console.warn('Not found in PouchDB:', err));

      // 3. TODO: Clear from CouchDB via API if connected

      alert("Account and all associated data permanently deleted.");
      location.reload();
    }
  </script></body>
  </html>
